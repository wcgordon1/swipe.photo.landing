---
// Assets
import { Image } from "astro:assets";
// Fundations
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/fundations/elements/Text.astro";
import Button from "@/components/fundations/elements/Button.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
// Components
import BlogCard from "@/components/blog/BlogCard.astro";
// Load all posts
import { getCollection } from "astro:content";
// Content
const allPosts = await getCollection("posts");
// Get the team slug from the URL
const teamSlug = Astro.url.pathname.split("/").filter(Boolean).pop();
// Filter and sort posts by this team (based on slug)
const relatedPosts = allPosts
  .filter((post) => post.data.team === teamSlug)
  .sort(
    (a, b) =>
      new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );
const { frontmatter } = Astro.props;
const bioParagraphs =
  frontmatter.bio
    ?.split("\n")
    .map((p) => p.trim())
    .filter(Boolean) ?? [];
const bioSummary = bioParagraphs[0] ?? "";
const socials = frontmatter.socials ?? {};
const achievements = frontmatter.achievements ?? [];
const socialLinks = [
  { label: "Twitter", href: socials.twitter ?? "#" },
  { label: "LinkedIn", href: socials.linkedin ?? "#" },
  { label: "Website", href: socials.website ?? "#" },
  { label: "Email", href: socials.email ?? "#" },
];
---

<BaseLayout
  title={frontmatter.name}
  description={bioSummary}
  ogImage={frontmatter.image.url.src}
>
  <section>
    <Wrapper variant="standard" class="border-b">
      <div class="p-8 relative bg-grid">
        <Text
          tag="h1"
          variant="display2XL"
          class="text-white tracking-tighter font-black uppercase relative text-balance"
        >
          {frontmatter.name}
        </Text>
      </div>

      <div
        class="grid grid-cols-1 lg:grid-cols-3 items-start justify-between gap-4 p-8 border-t border-white/20"
      >
        <div
          class="flex items-center gap-2 text-white text-sm uppercase font-medium"
        >
          <Image
            src={frontmatter.image.url}
            alt={frontmatter.image.alt}
            width="500"
            height="500"
            class="size-10 rounded-full object-cover border border-white/20"
          />
          <span>{frontmatter.name}</span>
        </div>
        <div class="lg:col-span-2">
          <Text tag="p" variant="textLG" class="text-base-500 uppercase">
            {frontmatter.role}
          </Text>
          <Text variant="textLG" tag="p" class="text-white font-medium mt-4">
            {bioSummary}
          </Text>
        </div>
      </div>

      <Image
        width={1400}
        height={800}
        src={frontmatter.image.url}
        alt={frontmatter.image.alt}
        class="w-full object-cover aspect-4/2"
      />

      <Wrapper variant="narrow" class="p-8 mx-auto">
        <Wrapper variant="prose">
          {
            bioParagraphs.map((paragraph) => (
              <Text tag="p" variant="textSM">
                {paragraph}
              </Text>
            ))
          }
          {
            achievements.length > 0 && (
              <>
                <Text
                  tag="h3"
                  variant="textBase"
                  class="font-semibold text-white mt-6"
                >
                  Achievements
                </Text>
                <ul class="list-disc pl-5 text-base-500 space-y-1">
                  {achievements.map((item) => (
                    <li>{item}</li>
                  ))}
                </ul>
              </>
            )
          }
          <slot />
        </Wrapper>
        {
          socialLinks.length > 0 && (
            <div class="flex flex-col gap-2 pt-6 mt-6 border-t border-white/20">
              {socialLinks.map((item) => (
                <a
                  href={item.href}
                  class="text-white hover:text-accent-500 w-fit"
                >
                  {item.label}
                </a>
              ))}
            </div>
          )
        }
      </Wrapper>
    </Wrapper>
  </section>

  {
    relatedPosts.length > 0 && (
      <section>
        <Wrapper variant="standard">
          <div class="p-8 bg-grid">
            <div class="flex items-center justify-between">
              <Text
                tag="h2"
                variant="displayMD"
                class="text-white font-black uppercase tracking-tighter"
              >
                Posts by {frontmatter.name}
              </Text>
              <Button
                isLink
                size="xs"
                variant="default"
                href="/blog"
                class="w-fit"
              >
                View all posts
              </Button>
            </div>
          </div>
          <div class="p-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 border-t border-white/20">
            {relatedPosts.slice(0, 3).map((post) => (
              <BlogCard post={post} />
            ))}
          </div>
        </Wrapper>
      </section>
    )
  }
</BaseLayout>
